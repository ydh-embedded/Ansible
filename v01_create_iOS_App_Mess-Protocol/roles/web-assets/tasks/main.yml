---
- name: "📄 Generate protocol HTML page"
  template:
    src: protocol.html.j2
    dest: "{{ project_path }}/src/sites/protocol.html"
    mode: '0644'
  tags: [web, html, protocol]

- name: "📜 Generate JavaScript modules"
  template:
    src: "{{ item }}.j2"
    dest: "{{ project_path }}/src/js/{{ item }}"
    mode: '0644'
  loop:
    - chart.js
    - weather.js
    - measurement.js
    - protocol.js
    - export.js
    - transfer.js
    - chartFallBack.js
    - keyboard-navigation.js
    - sectionID.js
  tags: [web, javascript, modules]

- name: "🖼️ Create app icon placeholders"
  copy:
    content: |
      <!-- Placeholder Icon for {{ item }} -->
      <!-- Replace with actual {{ item }} file -->
      <!-- Generated by Ansible iOS Generator v{{ script_version }} -->
    dest: "{{ project_path }}/src/assets/icons/{{ item }}.placeholder"
    mode: '0644'
  loop:
    - apple-touch-icon.png
    - favicon-32x32.png
    - favicon-16x16.png
    - android-chrome-192x192.png
    - android-chrome-512x512.png
    - mstile-150x150.png
  tags: [web, icons, assets]

- name: "📱 Generate PWA manifest"
  template:
    src: manifest.json.j2
    dest: "{{ project_path }}/src/manifest.json"
    mode: '0644'
  tags: [web, pwa, manifest]

- name: "🔧 Generate service worker"
  template:
    src: sw.js.j2
    dest: "{{ project_path }}/src/sw.js"
    mode: '0644'
  when: enable_enterprise|bool
  tags: [web, pwa, serviceworker]

- name: "📊 Create chart configuration"
  template:
    src: chart-config.js.j2
    dest: "{{ project_path }}/src/js/chart-config.js"
    mode: '0644'
  tags: [web, chart, config]

- name: "🌐 Generate additional HTML pages"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/src/sites/{{ item.dest }}"
    mode: '0644'
  loop:
    - src: measurements.html.j2
      dest: measurements.html
    - src: settings.html.j2
      dest: settings.html
    - src: about.html.j2
      dest: about.html
  when: enable_enterprise|bool
  tags: [web, html, pages]

- name: "🎨 Generate additional CSS files"
  template:
    src: "{{ item }}.j2"
    dest: "{{ project_path }}/src/styles/{{ item }}"
    mode: '0644'
  loop:
    - components.css
    - utilities.css
    - animations.css
  when: enable_quality|bool
  tags: [web, css, styles]

- name: "📝 Create web assets documentation"
  template:
    src: web-assets-readme.md.j2
    dest: "{{ project_path }}/src/README.md"
    mode: '0644'
  tags: [web, documentation]

- name: "🔍 Validate HTML files"
  shell: |
    if command -v tidy >/dev/null 2>&1; then
      find {{ project_path }}/src -name "*.html" -exec tidy -q -e {} \; || true
    else
      echo "HTML Tidy not found - skipping validation"
    fi
  register: html_validation
  changed_when: false
  tags: [web, validation]

- name: "📊 Display web assets summary"
  debug:
    msg: |
      📄 Web Assets Created:
      =====================
      HTML Pages: {{ project_path }}/src/index.html
                  {{ project_path }}/src/sites/protocol.html
      {% if enable_enterprise %}
                  {{ project_path }}/src/sites/measurements.html
                  {{ project_path }}/src/sites/settings.html
                  {{ project_path }}/src/sites/about.html
      {% endif %}
      
      JavaScript: {{ project_path }}/src/js/app.js
                  {{ project_path }}/src/js/chart.js
                  {{ project_path }}/src/js/weather.js
                  + 6 more modules
      
      Styles:     {{ project_path }}/src/styles/style.css
      {% if enable_quality %}
                  {{ project_path }}/src/styles/components.css
                  {{ project_path }}/src/styles/utilities.css
                  {{ project_path }}/src/styles/animations.css
      {% endif %}
      
      Assets:     {{ project_path }}/src/assets/icons/
                  {{ project_path }}/src/manifest.json
      {% if enable_enterprise %}
                  {{ project_path }}/src/sw.js
      {% endif %}
  tags: [web, summary]