---
- name: "📱 Create iOS platform directory structure"
  file:
    path: "{{ project_path }}/ios/{{ item }}"
    state: directory
    mode: '0755'
  loop:
    - App
    - App/App
    - App/App/Assets.xcassets
    - App/App/Assets.xcassets/AppIcon.appiconset
    - App/App/Assets.xcassets/Splash.imageset
    - App/public
  tags: [mobile, ios, structure]

- name: "🤖 Create Android platform directory structure"
  file:
    path: "{{ project_path }}/android/{{ item }}"
    state: directory
    mode: '0755'
  loop:
    - app/src/main
    - app/src/main/java/{{ app_id.split('.') | join('/') }}
    - app/src/main/res/values
    - app/src/main/res/drawable
    - app/src/main/res/mipmap-hdpi
    - app/src/main/res/mipmap-mdpi
    - app/src/main/res/mipmap-xhdpi
    - app/src/main/res/mipmap-xxhdpi
    - app/src/main/res/mipmap-xxxhdpi
    - app/src/main/assets
  tags: [mobile, android, structure]

- name: "🍎 Generate iOS configuration files"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/{{ item.dest }}"
    mode: "{{ item.mode | default('0644') }}"
  loop:
    - src: ios-info.plist.j2
      dest: ios/App/App/Info.plist
    - src: ios-config.xml.j2
      dest: ios/App/App/config.xml
    - src: ios-entitlements.j2
      dest: ios/App/App/App.entitlements
    - src: ios-contents.json.j2
      dest: ios/App/App/Assets.xcassets/Contents.json
    - src: ios-appicon-contents.json.j2
      dest: ios/App/App/Assets.xcassets/AppIcon.appiconset/Contents.json
  tags: [mobile, ios, config]

- name: "🤖 Generate Android configuration files"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/{{ item.dest }}"
    mode: "{{ item.mode | default('0644') }}"
  loop:
    - src: android-manifest.xml.j2
      dest: android/app/src/main/AndroidManifest.xml
    - src: android-strings.xml.j2
      dest: android/app/src/main/res/values/strings.xml
    - src: android-colors.xml.j2
      dest: android/app/src/main/res/values/colors.xml
    - src: android-styles.xml.j2
      dest: android/app/src/main/res/values/styles.xml
    - src: android-build.gradle.j2
      dest: android/app/build.gradle
    - src: android-gradle.properties.j2
      dest: android/gradle.properties
  tags: [mobile, android, config]

- name: "🔧 Generate Capacitor platform configurations"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/{{ item.dest }}"
    mode: '0644'
  loop:
    - src: capacitor-ios.config.json.j2
      dest: ios/capacitor.config.json
    - src: capacitor-android.config.json.j2
      dest: android/capacitor.config.json
  tags: [mobile, capacitor, config]

- name: "📱 Generate iOS Swift files"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/{{ item.dest }}"
    mode: '0644'
  loop:
    - src: ios-appdelegate.swift.j2
      dest: ios/App/App/AppDelegate.swift
    - src: ios-main.swift.j2
      dest: ios/App/App/main.swift
  tags: [mobile, ios, swift]

- name: "🤖 Generate Android Java/Kotlin files"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/{{ item.dest }}"
    mode: '0644'
  loop:
    - src: android-mainactivity.java.j2
      dest: android/app/src/main/java/{{ app_id.split('.') | join('/') }}/MainActivity.java
    - src: android-mainapplication.java.j2
      dest: android/app/src/main/java/{{ app_id.split('.') | join('/') }}/MainApplication.java
  tags: [mobile, android, java]

- name: "🎨 Create iOS app icons placeholders"
  copy:
    content: |
      // iOS App Icon Placeholder - {{ item }}
      // Replace with actual {{ item }} icon file
      // Generated by Ansible iOS Generator v{{ script_version }}
    dest: "{{ project_path }}/ios/App/App/Assets.xcassets/AppIcon.appiconset/{{ item }}.png.placeholder"
    mode: '0644'
  loop:
    - icon-20
    - icon-20@2x
    - icon-20@3x
    - icon-29
    - icon-29@2x
    - icon-29@3x
    - icon-40
    - icon-40@2x
    - icon-40@3x
    - icon-60@2x
    - icon-60@3x
    - icon-76
    - icon-76@2x
    - icon-83.5@2x
    - icon-1024
  tags: [mobile, ios, icons]

- name: "🎨 Create Android app icons placeholders"
  copy:
    content: |
      // Android App Icon Placeholder - {{ item }}
      // Replace with actual {{ item }} icon file
      // Generated by Ansible iOS Generator v{{ script_version }}
    dest: "{{ project_path }}/android/app/src/main/res/{{ item }}/ic_launcher.png.placeholder"
    mode: '0644'
  loop:
    - mipmap-hdpi
    - mipmap-mdpi
    - mipmap-xhdpi
    - mipmap-xxhdpi
    - mipmap-xxxhdpi
  tags: [mobile, android, icons]

- name: "🚀 Generate mobile platform scripts"
  template:
    src: "{{ item }}.j2"
    dest: "{{ project_path }}/scripts/{{ item }}"
    mode: '0755'
  loop:
    - ios-build.sh
    - android-build.sh
    - ios-deploy.sh
    - android-deploy.sh
    - mobile-sync.sh
  tags: [mobile, scripts]

- name: "📋 Generate mobile platform documentation"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/docs/{{ item.dest }}"
    mode: '0644'
  loop:
    - src: ios-setup.md.j2
      dest: iOS-Setup.md
    - src: android-setup.md.j2
      dest: Android-Setup.md
    - src: mobile-deployment.md.j2
      dest: Mobile-Deployment.md
  when: enable_enterprise|bool
  tags: [mobile, documentation]

- name: "🔐 Generate signing configurations"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/{{ item.dest }}"
    mode: '0600'
  loop:
    - src: ios-signing.j2
      dest: ios/signing.config
    - src: android-keystore.properties.j2
      dest: android/keystore.properties
  when: enable_enterprise|bool
  tags: [mobile, signing, security]

- name: "⚡ Generate Capacitor plugins configuration"
  template:
    src: capacitor-plugins.json.j2
    dest: "{{ project_path }}/capacitor-plugins.json"
    mode: '0644'
  tags: [mobile, capacitor, plugins]

- name: "🔌 Configure native plugins"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/{{ item.dest }}"
    mode: '0644'
  loop:
    - src: ios-podfile.j2
      dest: ios/Podfile
    - src: android-dependencies.gradle.j2
      dest: android/dependencies.gradle
  when: enable_enterprise|bool
  tags: [mobile, plugins, native]

- name: "🧪 Generate mobile testing configurations"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/{{ item.dest }}"
    mode: '0644'
  loop:
    - src: ios-test.swift.j2
      dest: ios/App/AppTests/AppTests.swift
    - src: android-test.java.j2
      dest: android/app/src/test/java/ExampleUnitTest.java
  when: enable_cicd|bool
  tags: [mobile, testing]

- name: "📊 Create mobile performance monitoring"
  template:
    src: "{{ item.src }}"
    dest: "{{ project_path }}/src/js/{{ item.dest }}"
    mode: '0644'
  loop:
    - src: mobile-analytics.js.j2
      dest: mobile-analytics.js
    - src: performance-monitor.js.j2
      dest: performance-monitor.js
  when: enable_analytics|bool
  tags: [mobile, analytics, performance]

- name: "🔄 Generate mobile sync utilities"
  template:
    src: "{{ item }}.j2"
    dest: "{{ project_path }}/scripts/mobile/{{ item }}"
    mode: '0755'
  loop:
    - sync-ios.sh
    - sync-android.sh
    - update-icons.sh
    - generate-splashscreens.sh
  when: enable_enterprise|bool
  tags: [mobile, sync, utilities]

- name: "📱 Create mobile utilities directory"
  file:
    path: "{{ project_path }}/scripts/mobile"
    state: directory
    mode: '0755'
  when: enable_enterprise|bool
  tags: [mobile, setup]

- name: "🎯 Configure mobile app metadata"
  template:
    src: app-metadata.json.j2
    dest: "{{ project_path }}/mobile-metadata.json"
    mode: '0644'
  tags: [mobile, metadata]

- name: "📊 Display mobile platforms summary"
  debug:
    msg: |
      📱 Mobile Platforms Configured:
      ===============================
      
      iOS Platform:
      ✅ iOS App structure created
      ✅ Info.plist configured
      ✅ App icons placeholders
      ✅ Swift files generated
      {% if enable_enterprise %}✅ Podfile & dependencies{% endif %}
      {% if enable_cicd %}✅ Test configurations{% endif %}
      
      Android Platform:
      ✅ Android App structure created
      ✅ AndroidManifest.xml configured
      ✅ App icons placeholders
      ✅ Java files generated
      ✅ Gradle build files
      {% if enable_enterprise %}✅ Native dependencies{% endif %}
      {% if enable_cicd %}✅ Test configurations{% endif %}
      
      Capacitor:
      ✅ iOS integration configured
      ✅ Android integration configured
      ✅ Plugin configurations
      ✅ Platform-specific settings
      
      {% if enable_enterprise %}
      Enterprise Features:
      ✅ Code signing configurations
      ✅ Mobile sync utilities
      ✅ Performance monitoring
      ✅ Complete documentation
      {% endif %}
      
      {% if enable_analytics %}
      Analytics:
      ✅ Mobile analytics tracking
      ✅ Performance monitoring
      {% endif %}
      
      Platform Paths:
      📁 iOS: {{ project_path }}/ios/
      📁 Android: {{ project_path }}/android/
      📁 Scripts: {{ project_path }}/scripts/
      {% if enable_enterprise %}📁 Docs: {{ project_path }}/docs/{% endif %}
  tags: [mobile, summary]

- name: "🚀 Display next steps for mobile development"
  debug:
    msg: |
      🚀 Mobile Development Next Steps:
      =================================
      
      1. Install Capacitor platforms:
         cd {{ project_name }}
         ionic cap add ios
         ionic cap add android
      
      2. Sync web code to native:
         ionic cap sync
      
      3. Open in native IDEs:
         ionic cap open ios      # Opens Xcode
         ionic cap open android  # Opens Android Studio
      
      4. Run on devices:
         ionic cap run ios --device
         ionic cap run android --device
      
      📋 Requirements:
      - iOS: Xcode 14+ (macOS only)
      - Android: Android Studio + SDK
      - Physical devices or simulators
      
      🔧 Additional Setup:
      {% if enable_enterprise %}
      - Configure code signing certificates
      - Setup app store credentials
      - Configure push notifications
      {% endif %}
      {% if enable_analytics %}
      - Setup analytics tracking
      - Configure crash reporting
      {% endif %}
  tags: [mobile, next-steps]